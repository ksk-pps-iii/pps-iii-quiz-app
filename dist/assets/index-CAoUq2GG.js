(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function o(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(t){if(t.ep)return;t.ep=!0;const a=o(t);fetch(t.href,a)}})();const P=document.getElementById("panel-main"),T=document.getElementById("panel-drugs-list");function z(e){P.classList.add("hidden"),T.classList.add("hidden"),e==="main"?P.classList.remove("hidden"):e==="drugs-list"&&T.classList.remove("hidden")}const W=document.querySelectorAll(".btn-goto-section");function M(){const e=L&&L.length>0&&L.some(n=>n.loadedContent&&n.loadedContent.length>0);W.forEach(n=>{n.disabled=!e})}const E=document.getElementById("area-eventloading"),N=document.getElementById("icon-area-eventload"),q=document.getElementById("txt-area-eventload"),G=document.getElementById("txt-area-eventload-eventremaining");let I=!1;function H(e,n=null){I||(E.classList.remove("hidden"),E.classList.add("animation-slide-in-y"),E.onanimationend=()=>{E.classList.remove("animation-slide-in-y")},I=!0),e&&(q.textContent=e),n?N.textContent=n:N.textContent="hourglass",G.textContent=J()}function R(){E.classList.contains("animation-slide-out-y")||I&&(E.classList.add("animation-slide-out-y"),E.onanimationend=()=>{E.classList.remove("animation-slide-out-y"),E.classList.add("hidden")},I=!1)}let S=[],k=!1;async function D(e,n,o=null){if(!e||!n||typeof n!="function")return Promise.reject(new Error("The event parameters are missing"));console.log("Added event : "+e);let s=new Promise((t,a)=>{S.push({name:e,event:n,icon:o,resolve:t,reject:a})});return $(),s}async function $(){if(k!==!0){if(S.length===0){console.log("[#] No events left to process."),R();return}for(k=!0;S.length>0;){const e=S.shift();if(!e||!e.event||typeof e.event!="function"||!e.resolve||!e.reject){console.error("[#] Invalid event in queue founded: Skipping",e),e&&e.reject&&e.reject(new Error("Invalid event in queue founded: Skipping"));continue}console.log("[#] Triggering Event: "+e.name),H(e.name,e.icon);try{console.log("Got Here");const n=await e.event();e.resolve(n)}catch(n){console.error("Error during event execution ("+e.name+"):",n),e.reject(n)}finally{console.log("[#] Event finished: "+e.name)}}k=!1,console.log("Queue processing finished."),R()}}function J(){return S.length+(k?1:0)}const U="https://script.google.com/macros/s/AKfycbwiO63v0RvmBAc1THJ6oBD-uy5C-6QS8y48VhEj6sDGg_Ur8bUW4_KUmnPuTOeyjjuSsA/exec";async function _(e,n){const o=JSON.stringify({...n});var s=await fetch(`${U}?action=${e}`,{method:"POST",body:o,headers:{"Content-Type":"text/plain;charset=utf-8"}}),t=await s.json();return t}const A=[{domain:"Number",key:["ลำดับที่(รันอัตโนมัติ)","ลำดับที่"]},{domain:"Generic Name",key:["ชื่อยา"]},{domain:"Class",key:["กลุ่มยา"],isMergedCells:!0,icon:"graph_3"},{domain:"MOA",key:["MOA"],icon:"hov"},{domain:"Indication",key:["Indications"],icon:"medical_services"},{domain:"Regimen",key:["Dosage Regimen"],icon:"lists"},{domain:"Metabolism",key:["Metabolism (ADME)"],icon:"change_circle"},{domain:"Limitations",key:["CrCl/EGFR ที่มีการแนะนำในผู้ป่วยไต (mL/min)"],icon:"warning"},{domain:"ADR",key:["ADRs/DIs ที่สำคัญ (Practical Point) เป็นไปได้อยากให้แบ่งระบบด้วย"],icon:"flash_on"},{domain:"Patient Education",key:["Patient Educations"],icon:"sms"}];function K(e){var n=e.map((o,s)=>{var t={};for(var a of A){var c=!1;if(a.key)for(var m of a.key)if(o[m]){t[a.domain]=o[m],c=!0;break}else t[a.domain]=null;if(!c&&a.isMergedCells===!0&&a.key)for(var l=s-1;l>=0;l--){let v=!1;for(var m of a.key)if(e[l][m].trim().length>0){t[a.domain]=e[l][m],c=!0,v=!0;break}if(v)break}}return t});return n}function Q(){return Math.floor(1e5+Math.random()*9e5).toString()}let p=[];const B=document.getElementById("modal-container");function j(e){const n=Q(),o=document.createElement("div");o.classList.add("window-modal","panel","area-padding20","area-fit-lim-handheld-90"),o.style.minWidth="30%",o.style.paddingTop="30px";const s=document.createElement("div");s.classList.add("txt-header"),s.textContent=e,o.appendChild(s);const t=document.createElement("button");t.classList.add("btn-modal-close","btn-normal","area-horizontal","area-center","placement-stick-top-right-5"),t.addEventListener("click",()=>V(n));const a=document.createElement("i");a.classList.add("material-symbols-outlined","icon"),a.textContent="close",t.appendChild(a),o.appendChild(t);const c={id:n,name:e,modal:o};return p.push(c),B.appendChild(o),O(),o}function V(e){const n=p.findLastIndex(o=>o.id===e);n<0||(p.splice(n,1).forEach(o=>{o.modal.remove()}),O())}function Y(e){const n=p.findLastIndex(o=>o.name===e);n<0||(p.splice(n,1).forEach(o=>{o.modal.remove()}),O())}function O(){if(p.length>0){for(let e=0;e<p.length;e++)if(p[e].modal){if(e===p.length-1){p[e].modal.classList.remove("hidden");continue}p[e].modal.classList.add("hidden")}B.classList.remove("hidden")}else B.classList.add("hidden")}function X(){var e=j("Sheets");const n=document.createElement("div");n.classList.add("area-horizontal","area-newline"),e.appendChild(n),L.forEach((r,u)=>{if(!r.isLoaded||!r.loadedContent||r.loadedContent.length<=0)return;const i=document.createElement("button");i.classList.add("btn-normal","area-fit-horizontal"),u===0&&(i.dataset.selected=!0,i.classList.add("btn-working","btn-drugs-sheet")),i.dataset.sheet=r.sheet;const d=document.createElement("span");d.classList.add("icon","material-symbols-outlined"),d.textContent="data_table",i.appendChild(d);const f=document.createElement("span");f.textContent=`${r.sheet} (${r.loadedContent.length})`,i.appendChild(f),n.appendChild(i),i.addEventListener("click",()=>{let g=i.dataset.selected==="true";if(g=!g,!g){var x=0;if(document.querySelectorAll(".btn-drugs-sheet").forEach(w=>{w.dataset.selected==="true"&&x++}),x<=1)return}g?(i.dataset.selected=!0,i.classList.add("btn-working")):(i.dataset.selected=!1,i.classList.remove("btn-working"))})});const o=document.createElement("div");o.classList.add("txt-header"),o.textContent="Mode",e.appendChild(o);const s=[],t=document.createElement("div");t.classList.add("area-horizontal","area-newline"),e.appendChild(t);const a=document.createElement("button");a.classList.add("btn-normal","btn-working"),a.dataset.mode="ordered",a.dataset.selected=!0;const c=document.createElement("span");c.classList.add("icon","material-symbols-outlined"),c.textContent="arrow_forward",a.appendChild(c);const m=document.createElement("span");m.textContent="Ordered",a.appendChild(m),t.appendChild(a);const l=document.createElement("button");l.classList.add("btn-normal"),l.dataset.mode="randomized",l.dataset.selected=!1;const v=document.createElement("span");v.classList.add("icon","material-symbols-outlined"),v.textContent="shuffle",l.appendChild(v);const C=document.createElement("span");C.textContent="Randomized",l.appendChild(C),t.appendChild(l),s.push(a,l),s.forEach(r=>{r.addEventListener("click",()=>{s.forEach(u=>{u.dataset.selected=!1,u.classList.remove("btn-working")}),r.dataset.selected=!0,r.classList.add("btn-working")})});const b=document.createElement("div");b.style.height="50px",e.appendChild(b);const y=document.createElement("div");y.classList.add("area-horizontal","area-center"),e.appendChild(y);const h=document.createElement("button");h.classList.add("btn-normal","btn-primary","area-fit-horizontal"),h.style.padding="2px 20px !important",h.textContent="Next",y.appendChild(h),h.addEventListener("click",()=>{var r=[];document.querySelectorAll(".btn-drugs-sheet").forEach(d=>{if(d.dataset.selected==="true"&&d.dataset.sheet){var f=L.find(g=>g.sheet===d.dataset.sheet);f&&(r=r.concat(f.loadedContent))}});var u=l.dataset.selected==="true";if(u){var i=[];r.forEach(d=>{const f=Math.floor(Math.random()*(i.length+1));i.splice(f,0,d)}),r=i}Y("Sheets"),z("drugs-list"),Z(r)})}function Z(e,n="masonry"){if(document.getElementById("btn-drugs-list-back")?.addEventListener("click",()=>{z("main")}),n==="masonry"){const t=[],a=document.getElementById("area-drugs-list-masonry");a.innerHTML="";const c=ee();for(var o=0;o<c;o++){var s=document.createElement("div");s.classList.add("masonry-column","area-vertical","area-fit-vertical"),s.style.maxWidth=`calc(${1/c*100}% - 10px)`,a.appendChild(s),t.push(s)}e&&e.forEach(m=>{for(var l=t[0],v=l.offsetHeight,C=1;C<t.length;C++){var b=t[C].offsetHeight;b<v&&(l=t[C],v=b)}if(!l)return;var y=document.createElement("div");y.classList.add("masonry-cell");const h=document.createElement("div");h.classList.add("area-fill-horizontal","area-horizontal"),y.appendChild(h);for(var r of A){var u=r.domain,i=m[u];if(i)if(u==="Number"){const d=document.createElement("span");d.classList.add("drug-number"),d.textContent=i,h.appendChild(d)}else if(u==="Generic Name"){const d=document.createElement("span");d.classList.add("drug-generic-name"),d.textContent=i,h.appendChild(d)}else if(u==="Class"){const d=document.createElement("span");d.classList.add("area-horizontal","area-fit-vertical","area-fit-horizontal"),d.textContent=i,d.style.color="#c1c1c1ff",d.style.fontWeight="bold",d.style.fontSize="13px",y.appendChild(d)}else{const d=document.createElement("div");d.classList.add("drug-area-domain");const f=document.createElement("span");f.classList.add("drug-domain");const g=document.createElement("span");g.classList.add("icon","material-symbols-outlined"),g.textContent=r.icon&&r.icon.trim().length>0?r.icon:"hourglass",f.appendChild(g);const x=document.createElement("span");x.textContent=u,f.appendChild(x),d.appendChild(f);const w=document.createElement("span");w.classList.add("drug-content-desc"),w.textContent=i,d.appendChild(w),y.appendChild(d)}}l.appendChild(y)})}}function ee(){const e=window.innerWidth;return e>=1024?4:e>=768?3:e>=640?2:1}function F(){const e=j("Drug Sheet Data Source"),n=document.createElement("div");n.classList.add("txt-description"),n.textContent="Please select the specific sheets from the Top Drug Source Sheets collection that you will be using for this session. You can modify these selections at any time by using the Load Sheets button.",e.appendChild(n);const o=document.createElement("div");o.classList.add("area-horizontal","area-newline"),e.appendChild(o),L.length>0&&L.forEach(s=>{const t=document.createElement("button");t.classList.add("btn-normal"),t.style.width="fit-content";const a=document.createElement("span");a.classList.add("material-symbols-outlined","icon"),a.textContent="data_array",t.appendChild(a);const c=document.createElement("span");c.textContent=s.sheet,t.appendChild(c),o.appendChild(t);const m=()=>{s.isLoaded&&s.loadedContent&&s.loadedContent.length>0?(t.classList.remove("btn-candidate"),t.classList.add("btn-success","btn-primary"),a.textContent="data_table"):(t.classList.remove("btn-success","btn-primary"),t.dataset.isCandidateForLoading==="true"?(t.classList.add("btn-candidate","btn-primary"),a.textContent="system_update_alt"):(t.classList.remove("btn-candidate","btn-primary"),a.textContent="data_array"))};m(),t.addEventListener("click",async()=>{t.classList.contains("btn-success")||(t.dataset.isCandidateForLoading=t.dataset.isCandidateForLoading!=="true",D(`Loading the sheet ${s.sheet}`,async()=>{const l=await _("getSheetDrugs",{sheet:s.sheet});s.isLoaded=!0,s.loadedContent=K(l.data),t.dataset.isCandidateForLoading=!1,M(),m()})),m()})})}let L=null;async function te(){M(),D("Retrieving the sheet names",async()=>{const e=await _("getSheetNames",{});var n=[...JSON.parse(e.data)];n.forEach(o=>{o.isLoaded=!1,o.isSelected=!1,o.loadedContent=null}),L=n,console.log(n),M()},"label"),D("Initial sheet settings",async()=>{F()},"data_table")}window.onload=await te;document.getElementById("btn-main-drugs").addEventListener("click",()=>{X()});document.getElementById("btn-setting-load-sheet").addEventListener("click",()=>{F()});
